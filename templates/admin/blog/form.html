{% extends "admin/layout.html" %}

{% block title %}{{ 'Edit' if post else 'Add' }} Blog Post | Admin Dashboard{% endblock %}

{% block head %}
{{ super() }}
<!-- Include TinyMCE for rich text editing -->
<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    tinymce.init({
      selector: '#content',
      plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount',
      toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat',
      height: 500,
      menubar: false,
      promotion: false
    });
  });
</script>
<style>
  .tox-promotion {
    display: none !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h1 class="h2">{{ 'Edit' if post else 'Add' }} Blog Post</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <a href="{{ url_for('admin_blog') }}" class="btn btn-sm btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i> Back to Blog Posts
            </a>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-12">
            <form method="POST" action="{{ url_for('admin_edit_blog_post', post_id=post.id) if post else url_for('admin_add_blog_post') }}" enctype="multipart/form-data">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Post Details</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="title" class="form-label">Title</label>
                            <input type="text" class="form-control" id="title" name="title" value="{{ post.title if post else '' }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="category" class="form-label">Category</label>
                            <input type="text" class="form-control" id="category" name="category" value="{{ post.category if post else '' }}" placeholder="e.g. Career Tips, Software, Resume">
                            <div class="form-text">Categories help organize your posts. Use common categories to group related posts.</div>
                        </div>
                        <div class="mb-3">
                            <label for="featured_image_upload" class="form-label">Upload Featured Image</label>
                            <input type="file" class="form-control" id="featured_image_upload" name="featured_image_upload" accept="image/*">
                            <div class="form-text">Upload an image that represents this post (JPG, PNG, or GIF).</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="featured_image" class="form-label">Or Enter Image URL (optional)</label>
                            <input type="url" class="form-control" id="featured_image" name="featured_image" value="{{ post.featured_image if post else '' }}" placeholder="https://example.com/image.jpg">
                            <div class="form-text">If you don't upload an image, you can enter a URL to an image instead. This is optional.</div>
                        </div>
                        
                        {% if post and post.featured_image %}
                        <div class="mb-3">
                            <label class="form-label">Current Featured Image</label>
                            <div class="mt-2">
                                <img src="{{ post.featured_image }}" alt="Featured image" style="max-width: 100%; max-height: 200px; border-radius: 4px; border: 1px solid #ddd;">
                            </div>
                        </div>
                        {% endif %}
                        <div class="mb-3">
                            <label for="content" class="form-label">Content</label>
                            <textarea class="form-control" id="content" name="content" rows="10" required>{{ post.content if post else '' }}</textarea>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Publishing Options</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="is_published" name="is_published" {% if post and post.is_published %}checked{% endif %}>
                            <label class="form-check-label" for="is_published">Publish this post</label>
                        </div>
                        <div class="form-text">
                            {% if post %}
                                <p><strong>Created:</strong> {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                                <p><strong>Last Updated:</strong> {{ post.updated_at.strftime('%Y-%m-%d %H:%M') }}</p>
                                {% if post.is_published %}
                                    <p><strong>Status:</strong> <span class="badge bg-success">Published</span></p>
                                {% else %}
                                    <p><strong>Status:</strong> <span class="badge bg-secondary">Draft</span></p>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between mb-4">
                    <a href="{{ url_for('admin_blog') }}" class="btn btn-light">Cancel</a>
                    <button type="submit" class="btn btn-primary">{{ 'Update' if post else 'Create' }} Post</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}