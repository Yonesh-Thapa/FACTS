{% extends "layout.html" %}

{% block title %}F.A.C.T.S - Admin Dashboard{% endblock %}

{% block head_extra %}
<style>
    .admin-nav {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    .admin-nav .nav-link {
        color: #333;
        padding: 10px 15px;
        border-radius: 5px;
        margin: 5px 0;
    }
    
    .admin-nav .nav-link.active {
        background-color: var(--primary-color);
        color: white;
    }
    
    .admin-card {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .admin-card h3 {
        color: var(--primary-color);
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
    }
    
    .table-responsive {
        overflow-x: auto;
    }
    
    .admin-table th {
        background-color: #f8f9fa;
    }
    
    .action-btns .btn {
        padding: 5px 10px;
        font-size: 0.8rem;
        margin-right: 5px;
    }
</style>
{% endblock %}

{% block content %}
<section class="page-header admin-header">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1>Admin Dashboard</h1>
                <p class="lead">Manage website content and view inquiries</p>
                <div class="d-flex justify-content-between align-items-center">
                    <p class="user-info">Logged in as: <strong>{{ current_user }}</strong></p>
                    <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-light">Logout</a>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="admin-dashboard-section">
    <div class="container">
        <div class="row">
            <!-- Admin Navigation -->
            <div class="col-lg-3 mb-4">
                <div class="admin-nav">
                    <h4>Dashboard</h4>
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link active" id="v-pills-contacts-tab" data-bs-toggle="pill" href="#v-pills-contacts" role="tab" aria-controls="v-pills-contacts" aria-selected="true">Contact Inquiries</a>
                        <a class="nav-link" id="v-pills-enrollments-tab" data-bs-toggle="pill" href="#v-pills-enrollments" role="tab" aria-controls="v-pills-enrollments" aria-selected="false">Enrollments</a>
                        <a class="nav-link" id="v-pills-testimonials-tab" data-bs-toggle="pill" href="#v-pills-testimonials" role="tab" aria-controls="v-pills-testimonials" aria-selected="false">Testimonials</a>
                        <a class="nav-link" id="v-pills-faqs-tab" data-bs-toggle="pill" href="#v-pills-faqs" role="tab" aria-controls="v-pills-faqs" aria-selected="false">FAQs</a>
                    </div>
                </div>
            </div>
            
            <!-- Admin Content -->
            <div class="col-lg-9">
                <div class="tab-content" id="v-pills-tabContent">
                    <!-- Contact Inquiries Tab -->
                    <div class="tab-pane fade show active" id="v-pills-contacts" role="tabpanel" aria-labelledby="v-pills-contacts-tab">
                        <div class="admin-card">
                            <h3>Contact Inquiries</h3>
                            
                            {% if contacts %}
                                <div class="table-responsive">
                                    <table class="table table-striped admin-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Subject</th>
                                                <th>Interested in Enrollment</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for contact in contacts %}
                                                <tr>
                                                    <td>{{ contact.created_at.strftime('%Y-%m-%d') }}</td>
                                                    <td>{{ contact.name }}</td>
                                                    <td>{{ contact.email }}</td>
                                                    <td>{{ contact.subject or 'N/A' }}</td>
                                                    <td>{{ 'Yes' if contact.interested else 'No' }}</td>
                                                    <td class="action-btns">
                                                        <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#viewContactModal{{ contact.id }}">View</button>
                                                        <a href="{{ url_for('admin_delete_contact', contact_id=contact.id) }}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this inquiry?');">Delete</a>
                                                    </td>
                                                </tr>
                                                
                                                <!-- View Contact Modal -->
                                                <div class="modal fade" id="viewContactModal{{ contact.id }}" tabindex="-1" aria-labelledby="viewContactModalLabel{{ contact.id }}" aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="viewContactModalLabel{{ contact.id }}">Inquiry from {{ contact.name }}</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p><strong>Date:</strong> {{ contact.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                                                                <p><strong>Name:</strong> {{ contact.name }}</p>
                                                                <p><strong>Email:</strong> {{ contact.email }}</p>
                                                                <p><strong>Subject:</strong> {{ contact.subject or 'N/A' }}</p>
                                                                <p><strong>Interested in Enrollment:</strong> {{ 'Yes' if contact.interested else 'No' }}</p>
                                                                <p><strong>Message:</strong></p>
                                                                <div class="p-3 bg-light rounded">{{ contact.message }}</div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                <a href="mailto:{{ contact.email }}" class="btn btn-primary">Reply via Email</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="alert alert-info">No contact inquiries found.</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Enrollments Tab -->
                    <div class="tab-pane fade" id="v-pills-enrollments" role="tabpanel" aria-labelledby="v-pills-enrollments-tab">
                        <div class="admin-card">
                            <h3>Enrollments</h3>
                            
                            {% if enrollments %}
                                <div class="table-responsive">
                                    <table class="table table-striped admin-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Phone</th>
                                                <th>Payment Type</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for enrollment in enrollments %}
                                                <tr>
                                                    <td>{{ enrollment.created_at.strftime('%Y-%m-%d') }}</td>
                                                    <td>{{ enrollment.name }}</td>
                                                    <td>{{ enrollment.email }}</td>
                                                    <td>{{ enrollment.phone or 'N/A' }}</td>
                                                    <td>{{ enrollment.payment_type|title }}</td>
                                                    <td>
                                                        <span class="badge {% if enrollment.payment_status == 'completed' %}bg-success{% elif enrollment.payment_status == 'pending' %}bg-warning{% else %}bg-danger{% endif %}">
                                                            {{ enrollment.payment_status|title }}
                                                        </span>
                                                    </td>
                                                    <td class="action-btns">
                                                        <a href="{{ url_for('admin_edit_enrollment', enrollment_id=enrollment.id) }}" class="btn btn-primary">Edit</a>
                                                        <a href="{{ url_for('admin_delete_enrollment', enrollment_id=enrollment.id) }}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this enrollment?');">Delete</a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="alert alert-info">No enrollments found.</div>
                            {% endif %}
                            
                            <div class="mt-3">
                                <a href="{{ url_for('admin_add_enrollment') }}" class="btn btn-success">Add New Enrollment</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Testimonials Tab -->
                    <div class="tab-pane fade" id="v-pills-testimonials" role="tabpanel" aria-labelledby="v-pills-testimonials-tab">
                        <div class="admin-card">
                            <h3>Testimonials</h3>
                            
                            {% if testimonials %}
                                <div class="table-responsive">
                                    <table class="table table-striped admin-table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Role</th>
                                                <th>Rating</th>
                                                <th>Featured</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for testimonial in testimonials %}
                                                <tr>
                                                    <td>{{ testimonial.name }}</td>
                                                    <td>{{ testimonial.role or 'N/A' }}</td>
                                                    <td>
                                                        {% for i in range(testimonial.rating or 0) %}
                                                            <i class="fas fa-star text-warning"></i>
                                                        {% endfor %}
                                                    </td>
                                                    <td>{{ 'Yes' if testimonial.is_featured else 'No' }}</td>
                                                    <td class="action-btns">
                                                        <a href="{{ url_for('admin_edit_testimonial', testimonial_id=testimonial.id) }}" class="btn btn-primary">Edit</a>
                                                        <a href="{{ url_for('admin_toggle_testimonial_feature', testimonial_id=testimonial.id) }}" class="btn btn-warning">
                                                            {% if testimonial.is_featured %}Unfeature{% else %}Feature{% endif %}
                                                        </a>
                                                        <a href="{{ url_for('admin_delete_testimonial', testimonial_id=testimonial.id) }}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this testimonial?');">Delete</a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="alert alert-info">No testimonials found.</div>
                            {% endif %}
                            
                            <div class="mt-3">
                                <a href="{{ url_for('admin_add_testimonial') }}" class="btn btn-success">Add New Testimonial</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- FAQs Tab -->
                    <div class="tab-pane fade" id="v-pills-faqs" role="tabpanel" aria-labelledby="v-pills-faqs-tab">
                        <div class="admin-card">
                            <h3>Frequently Asked Questions</h3>
                            
                            {% if faqs %}
                                <div class="list-group">
                                    {% for faq in faqs %}
                                        <div class="list-group-item list-group-item-action">
                                            <div class="d-flex w-100 justify-content-between align-items-center">
                                                <h5 class="mb-1">{{ faq.question }}</h5>
                                                <div>
                                                    <a href="{{ url_for('admin_edit_faq', faq_id=faq.id) }}" class="btn btn-primary btn-sm">Edit</a>
                                                    <a href="{{ url_for('admin_toggle_faq_publish', faq_id=faq.id) }}" class="btn btn-warning btn-sm">
                                                        {% if faq.is_published %}Unpublish{% else %}Publish{% endif %}
                                                    </a>
                                                    <a href="{{ url_for('admin_delete_faq', faq_id=faq.id) }}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this FAQ?');">Delete</a>
                                                </div>
                                            </div>
                                            <p class="mb-1">{{ faq.answer }}</p>
                                            <small class="text-muted">
                                                Position: {{ faq.position }} | 
                                                Status: {{ 'Published' if faq.is_published else 'Draft' }}
                                            </small>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="alert alert-info">No FAQs found.</div>
                            {% endif %}
                            
                            <div class="mt-3">
                                <a href="{{ url_for('admin_add_faq') }}" class="btn btn-success">Add New FAQ</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}