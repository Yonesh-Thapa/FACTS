{% macro info_session_booking_form() %}
<div class="booking-form-container">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Book a Free Info Session</h3>
        </div>
        <div class="card-body">
            <form id="infoSessionBookingForm" action="{{ url_for('book_info_session') }}" method="POST" class="needs-validation" novalidate>
                <!-- Name Field -->
                <div class="form-group mb-3">
                    <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="name" name="name" required>
                    <div class="invalid-feedback">
                        Please provide your name.
                    </div>
                </div>
                
                <!-- Email Field -->
                <div class="form-group mb-3">
                    <label for="email" class="form-label">Email Address <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="email" name="email" required>
                    <div class="invalid-feedback">
                        Please provide a valid email address.
                    </div>
                </div>
                
                <!-- Phone Field -->
                <div class="form-group mb-3">
                    <label for="phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                    <input type="tel" class="form-control" id="phone" name="phone" required>
                    <div class="invalid-feedback">
                        Please provide your phone number.
                    </div>
                </div>
                
                <!-- Date Field -->
                <div class="form-group mb-3">
                    <label for="preferred_date" class="form-label">Preferred Date <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" id="preferred_date" name="preferred_date" min="{{ tomorrow_date }}" required>
                    <div class="invalid-feedback">
                        Please select a preferred date.
                    </div>
                </div>
                
                <!-- Time Field -->
                <div class="form-group mb-3">
                    <label for="preferred_time" class="form-label">Preferred Time <span class="text-danger">*</span></label>
                    <select class="form-select" id="preferred_time" name="preferred_time" required>
                        <option value="" selected disabled>Select a time</option>
                        <option value="09:00">9:00 AM</option>
                        <option value="10:00">10:00 AM</option>
                        <option value="11:00">11:00 AM</option>
                        <option value="12:00">12:00 PM</option>
                        <option value="13:00">1:00 PM</option>
                        <option value="14:00">2:00 PM</option>
                        <option value="15:00">3:00 PM</option>
                        <option value="16:00">4:00 PM</option>
                        <option value="17:00">5:00 PM</option>
                        <option value="18:00">6:00 PM</option>
                        <option value="19:00">7:00 PM</option>
                        <option value="20:00">8:00 PM</option>
                    </select>
                    <div class="invalid-feedback">
                        Please select a preferred time.
                    </div>
                </div>
                
                <!-- Comments Field -->
                <div class="form-group mb-3">
                    <label for="comments" class="form-label">Additional Comments</label>
                    <textarea class="form-control" id="comments" name="comments" rows="3"></textarea>
                </div>
                
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">Book Your Info Session</button>
                </div>
                
                <div class="mt-3 text-center">
                    <small>We'll send you a Zoom link for the info session after confirming your booking.</small>
                </div>
            </form>
            
            <!-- Success Message (hidden by default) -->
            <div id="bookingSuccessMessage" class="alert alert-success mt-3" style="display: none;">
                <h5 class="mb-2"><i class="fas fa-check-circle me-2"></i>Thank you for your booking request!</h5>
                <p class="mb-0">We've received your info session request. We'll be in touch soon with your Zoom invite.</p>
            </div>
            
            <!-- Error Message (hidden by default) -->
            <div id="bookingErrorMessage" class="alert alert-danger mt-3" style="display: none;">
                <h5 class="mb-2"><i class="fas fa-exclamation-circle me-2"></i>Oops! Something went wrong.</h5>
                <p class="mb-0">Please try submitting the form again or contact us directly.</p>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Form validation
        const form = document.getElementById('infoSessionBookingForm');
        
        if (form) {
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                } else {
                    // If form is valid, handle submission via AJAX
                    event.preventDefault();
                    
                    const submitButton = form.querySelector('button[type="submit"]');
                    const originalButtonText = submitButton.innerHTML;
                    submitButton.disabled = true;
                    submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Processing...';
                    
                    const formData = new FormData(form);
                    
                    fetch(form.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                        
                        if (data.success) {
                            // Show success message
                            form.style.display = 'none';
                            document.getElementById('bookingSuccessMessage').style.display = 'block';
                            // Reset form
                            form.reset();
                        } else {
                            // Show error message
                            document.getElementById('bookingErrorMessage').style.display = 'block';
                            document.getElementById('bookingErrorMessage').scrollIntoView({ behavior: 'smooth' });
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                        document.getElementById('bookingErrorMessage').style.display = 'block';
                        document.getElementById('bookingErrorMessage').scrollIntoView({ behavior: 'smooth' });
                    });
                }
                
                form.classList.add('was-validated');
            });
        }
        
        // Set minimum date to tomorrow
        const dateInput = document.getElementById('preferred_date');
        if (dateInput) {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const formattedDate = tomorrow.toISOString().split('T')[0];
            dateInput.min = formattedDate;
        }
    });
</script>
{% endmacro %}